extends layout


block content
    meta(name="csrf-token", content=csrfToken)
    script.
        var interval = undefined;
        function progress(){
            var ids= $(".page").map(function() {
                return $(this).attr("value");
            }).get();
            var token = document.querySelector('meta[name="csrf-token"]').getAttribute('content')
            //console.log(ids);
            $.ajax({
                type: 'POST',
                url: 'progress',
                headers: {  
                    'CSRF-Token': token
                },  
                data: {
                   pageId: ids
                }
            }).then(function(result){
                $('#progress').replaceWith($('#progress', result));
                if($('#completed').text()==='completed'){
                  clearInterval(interval);
                }
            });
        };
        interval = setInterval(function () {progress()}, 2000);
        
    .jumbotoron
      h3= "Progress"
    #progress
      if completed===true
        h3#completed completed
      else
        #completed.spinner-border
      if webpages
        if webpages.length
          table.table.table-striped.table-bordered.table-hover.table-sm
            tr.thead-light.d-flex
              th.col-3 createdAt
              th.col-3 url
              th.col-2 title
              th.col-1 size
              th.col-3 page
            each webpage in webpages
              tr.d-flex.page(value=webpage._id)
                td.col-3= moment(webpage.createdAt).format('YYYY-MM-DD HH:mm:ss Z')
                td.col-3
                  a(href=rootPath + "search/page?input=" + encodeURIComponent(webpage.input)) Input
                  p= webpage.input
                  if webpage.url
                    //a(href=rootPath + "search/page?url=" + webpage.url) 
                    a= "Result"
                    p
                      a(href=rootPath + "page/" +webpage._id) #{webpage.url}
                  else
                    a(href=rootPath + "page/" +webpage._id) id: #{webpage._id}
                td.col-2
                  if webpage.title
                    a(href=rootPath + "search/page?title=" +webpage.title) #{webpage.title}
                td.col-1
                  if webpage.content
                    p= webpage.content.length
                td.col-3
                  if webpage.thumbnail
                    a.colorbox(href=rootPath + "page/screenshot/" +webpage._id)
                      img(src="data:image/png;base64," + webpage.thumbnail)
