extends layout

block content
  h1 Website
  if website
      include include/sitemodal.pug
      .row
        .col-12
          h2= "URL: " 
            a(href=rootPath + "website/" + website._id)= website.url
            a(href=rootPath + "search/website?rurl=" + encodeURIComponent(website.url)) üîç
          h6= "createdAt: " + website.createdAt
          //h6= "updatedAt: " + website.updatedAt
      .row
        .col-4
          h5= "tag: "
            each tag in website.tag
              each val, key in tag
                span.badge.badge-primary
                  a= key + ":" + val 
                  a.text-light(href=rootPath + "website/" + website._id + "?rmtag=" + key +":"+val)= " [x]"
                a= " "

          form(method="post" action=rootPath + "website/" + website._id)
            .row
              .col-2
                input.btn.btn-sm.btn-outline-primary(type="submit" name="submit", value="add")
              .col-5
                input(type="text" name="type" id="type" placeholder="type")
              .col-5
                input(type="text" name="tag" id="tag" placeholder="value")
              input(type="hidden" name="_csrf", value=csrfToken)
        .col-8
          button.btn.btn-sm.btn-outline-primary(data-toggle="collapse" data-target="#track") track ‚ñΩ
          div#track.collapse
            a.btn.btn-sm.btn-primary(data-toggle="modal",data-target="#update_form", style="color:white;cursor:pointer;") Update
            pre= JSON.stringify(website.track, null, " ")
          br
          br
          button.btn.btn-sm.btn-outline-primary(data-toggle="collapse" data-target="#gsb") Google Safe Browsing ‚ñΩ
          div#gsb.collapse
            //a.btn.btn-sm.btn-primary(href=rootPath + "api/gsblookup/" + website._id) Lookup
            button.btn.btn-sm.btn-primary(onclick="lookup()") Lookup

            pre#gsblookup= JSON.stringify(website.gsb.lookup, null, " ")
          script.
              function lookup(){
                var apiPath = #{rootPath};
                $.ajax({
                  type: "post",
                  url: apiPath + "api/gsblookup",
                  data:JSON.stringify({"id":"#{website._id}"}),
                  contentType: 'application/json',
                  dataType: "json",            
                  success: function(result) { 
                    $('pre#gsblookup').text(JSON.stringify(result, null, " "));
                  },
                })
              };

      if webpages
        include include/pagelist.pug
        //include include/table.pug

  else
    div.alert.alert-warning
      p No data